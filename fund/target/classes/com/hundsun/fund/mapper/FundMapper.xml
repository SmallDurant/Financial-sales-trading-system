<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hundsun.fund.mapper.FundMapper">

    <!-- ResultMap to map the columns to the FundDTO properties -->
    <resultMap id="fundResultMap" type="com.hundsun.fund.fund.dto.FundDTO">
        <id column="fund_id" property="fundId"/>
        <result column="fund_code" property="fundCode"/>
        <result column="fund_name" property="fundName"/>
        <result column="fund_administrator" property="fundAdministrator"/>
        <result column="fund_trustee" property="fundTrustee"/>
        <result column="fund_issuer" property="fundIssuer"/>
        <result column="effective_date" property="effectiveDate"/>
        <result column="fund_type" property="fundType"/>
        <result column="transaction_currency" property="transactionCurrency"/>
        <result column="fund_risk" property="fundRisk"/>
        <result column="fund_status" property="fundStatus"/>
        <result column="charge_way" property="chargeWay"/>
        <result column="purchase_rate" property="purchaseRate"/>
        <result column="redemption_rate" property="redemptionRate"/>
        <result column="management_fee_rate" property="managementFeeRate"/>
        <result column="custodian_fee_rate" property="custodianFeeRate"/>
        <result column="fund_size" property="fundSize"/>
        <result column="establishment_scale" property="establishmentScale"/>
        <result column="fund_shares" property="fundShares"/>
        <result column="min_purchase_amount" property="minPurchaseAmount"/>
        <result column="nav" property="nav"/>
        <result column="cnav" property="cnav"/>
        <result column="investment_philosophy" property="investmentPhilosophy"/>
        <result column="investment_scope" property="investmentScope"/>
        <result column="investment_strategy" property="investmentStrategy"/>
        <result column="operation_mode" property="operationMode"/>
        <result column="fund_stage" property="fundStage"/>
        <result column="is_delete" property="isDelete"/>
    </resultMap>

    <!-- 查所有未删除的基金 -->
    <select id="findAllFunds" resultMap="fundResultMap">
        SELECT * FROM tfund WHERE is_delete = 0
    </select>

    <!-- 根据fundId查基金 -->
    <select id="findFundById" parameterType="long" resultMap="fundResultMap">
        SELECT * FROM tfund WHERE fund_id = #{fundId} AND is_delete = 0
    </select>

    <!-- 增加新的基金 -->
    <insert id="createFund" parameterType="com.hundsun.fund.fund.dto.FundDTO" useGeneratedKeys="true" keyProperty="fundId">
        INSERT INTO tfund (fund_code, fund_name, fund_administrator, fund_trustee, fund_issuer, effective_date, fund_type, transaction_currency, fund_risk, fund_status, charge_way, purchase_rate, redemption_rate, management_fee_rate, custodian_fee_rate, fund_size, establishment_scale, fund_shares, min_purchase_amount, nav, cnav, investment_philosophy, investment_scope, investment_strategy, operation_mode, fund_stage, is_delete)
        VALUES (#{fundCode}, #{fundName}, #{fundAdministrator}, #{fundTrustee}, #{fundIssuer}, #{effectiveDate}, #{fundType}, #{transactionCurrency}, #{fundRisk}, #{fundStatus}, #{chargeWay}, #{purchaseRate}, #{redemptionRate}, #{managementFeeRate}, #{custodianFeeRate}, #{fundSize}, #{establishmentScale}, #{fundShares}, #{minPurchaseAmount}, #{nav}, #{cnav}, #{investmentPhilosophy}, #{investmentScope}, #{investmentStrategy}, #{operationMode}, #{fundStage}, #{isDelete})
    </insert>

    <!-- 更新fundId基金  可能有问题-->
    <update id="updateFund" parameterType="com.hundsun.fund.fund.dto.FundDTO">
        UPDATE tfund
        SET fund_code = #{fundCode},
        fund_name = #{fundName},
        fund_administrator = #{fundAdministrator},
        fund_trustee = #{fundTrustee},
        fund_issuer = #{fundIssuer},
        effective_date = #{effectiveDate},
        fund_type = #{fundType},
        transaction_currency = #{transactionCurrency},
        fund_risk = #{fundRisk},
        fund_status = #{fundStatus},
        charge_way = #{chargeWay},
        purchase_rate = #{purchaseRate},
        redemption_rate = #{redemptionRate},
        management_fee_rate = #{managementFeeRate},
        custodian_fee_rate = #{custodianFeeRate},
        fund_size = #{fundSize},
        establishment_scale = #{establishmentScale},
        fund_shares = #{fundShares},
        min_purchase_amount = #{minPurchaseAmount},
        nav = #{nav},
        cnav = #{cnav},
        investment_philosophy = #{investmentPhilosophy},
        investment_scope = #{investmentScope},
        investment_strategy = #{investmentStrategy},
        operation_mode = #{operationMode},
        fund_stage = #{fundStage},
        is_delete = #{isDelete}
        WHERE fund_id = #{fundId}
    </update>

    <!-- 逻辑删除fundId基金 -->
    <update id="deleteFund" parameterType="long">
        UPDATE tfund SET is_delete = 1 WHERE fund_id = #{fundId}
    </update>

    <!-- 查所某userId的基金持仓 -->
    <select id="findFundholdingsByUserId" parameterType="long" resultMap="com.hundsun.fund.fund.dto.FundholdingsDTO">
        SELECT * FROM tportion WHERE user_id = #{userId}
    </select>

</mapper>
